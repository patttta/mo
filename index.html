<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íëª¨ì½” ì¿ ë¦¬ë¹µ</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
  text-align: center;
  padding: 60px;
}

.logo-wrap img {
  max-width: 350px;
  cursor: pointer;
  margin-bottom: 30px;
}

.title-image img {
  max-width: 280px;
  cursor: pointer;
  margin-bottom: 30px;
}

.result {
  display: none;
  margin-top: 30px;
}

.image-box {
  position: relative;
  width: 100%;
  height: 260px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.image-box img {
  max-width: 100%;
  max-height: 100%;
  z-index: 2;
}

.result-text {
  margin-top: 18px;
  font-size: 18px;
}

/* ë‘ê·¼ë‘ê·¼ */
@keyframes heartbeat {
  0% { transform: scale(1); }
  50% { transform: scale(1.06); }
  100% { transform: scale(1); }
}
.waiting {
  animation: heartbeat 0.6s infinite;
  opacity: 0.7;
}

/* íŒ */
@keyframes pop {
  0% { opacity: 0; transform: scale(0.85); }
  100% { opacity: 1; transform: scale(1); }
}
.pop {
  animation: pop 0.35s ease-out;
}

/* â­ ë…¸ë€ ë³„ íŒ¡ */
.star {
  position: absolute;
  font-size: 22px;
  color: #FFD84D;
  animation: starFly 1.4s ease-out forwards;
  pointer-events: none;
  z-index: 5;
}

@keyframes starFly {
  0% { opacity: 0; transform: translate(0,0) scale(0.4); }
  30% { opacity: 1; }
  100% {
    opacity: 0;
    transform: translate(var(--x), var(--y)) scale(1.2);
  }
}

.copyright {
  margin-top: 100px;
  font-size: 12px;
  color: #8D7860;
}
</style>
</head>

<body>

<div class="logo-wrap">
  <img src="https://i.imgur.com/rYcxn0Z.png" onclick="location.reload()">
</div>

<div class="title-image" onclick="drawBeads()">
  <img id="drawImage" src="https://i.imgur.com/e9JGabn.png">
</div>

<div class="result" id="resultBox">
  <div class="image-box" id="imageBox">
    <img id="resultImage">
  </div>
  <div class="result-text" id="resultText"></div>
</div>

<div class="copyright">Â© Pong PocoPoco Project</div>

<script>
/* ğŸ”§ í…ŒìŠ¤íŠ¸ ëë‚˜ë©´ false */
const TEST_MODE = false;

/* ë‚ ì§œ (ìì • ê¸°ì¤€) */
function getToday() {
  const d = new Date();
  return d.getFullYear() + "-" +
    String(d.getMonth() + 1).padStart(2,"0") + "-" +
    String(d.getDate()).padStart(2,"0");
}

/* ì•„ì´í…œ */
const items = [
  { img:"https://i.imgur.com/6ZgUNGp.png", text:"ëš±ëš±ì¿ ë¦¬ ë“±ì¥!", weight:40 },
  { img:"https://i.imgur.com/O8UUh0T.png", text:"ì—´ê³µì¿ ë¦¬ ë“±ì¥!", weight:40 },
  { img:"https://i.imgur.com/aqYwzkm.png", text:"ë°”ë³´ì¿ ë¦¬ ë“±ì¥!", weight:40 },
  { img:"https://i.imgur.com/OBTpOLq.png", text:"âœ¨ ì‹œí¬ë¦¿ ê°¸ë£¨ì¿ ë¦¬ ë“±ì¥!! âœ¨", weight:15, hidden:true }
];

/* ê°€ì¤‘ì¹˜ ëœë¤ */
function weightedRandom(list) {
  const total = list.reduce((s,i)=>s+i.weight,0);
  let r = Math.random() * total;
  for (const item of list) {
    r -= item.weight;
    if (r < 0) return item;
  }
}

/* â­ ë³„ íŒ¡ */
function spawnStars() {
  const box = document.getElementById("imageBox");
  for (let i=0;i<14;i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.innerText = "â˜…";

    const angle = Math.random() * Math.PI * 2;
    const radius = 120 + Math.random()*60;
    star.style.setProperty("--x", Math.cos(angle)*radius+"px");
    star.style.setProperty("--y", Math.sin(angle)*radius+"px");

    box.appendChild(star);
    setTimeout(()=>star.remove(),1400);
  }
}

/* ê²°ê³¼ í‘œì‹œ */
function showResult(result) {
  const box = document.getElementById("resultBox");
  const img = document.getElementById("resultImage");
  const text = document.getElementById("resultText");

  box.style.display = "block";
  img.src = result.img;
  text.innerText = result.text;
  img.classList.add("pop");

  if (result.hidden) spawnStars();
}

/* ë½‘ê¸° */
function drawBeads() {
  const today = getToday();

  if (!TEST_MODE && localStorage.getItem("drawDate") === today) {
    alert("ì˜¤ëŠ˜ì€ ì´ë¯¸ ë½‘ì•˜ì–´ìš”!\në‚´ì¼ ë‹¤ì‹œ ë„ì „í•´ ì£¼ì„¸ìš”ğŸ’›");
    return;
  }

  const drawImg = document.getElementById("drawImage");
  drawImg.classList.add("waiting");

  setTimeout(() => {
    drawImg.classList.remove("waiting");

    const result = weightedRandom(items);
    showResult(result);

    if (!TEST_MODE) {
      localStorage.setItem("drawDate", today);
      localStorage.setItem("drawResult", JSON.stringify(result));
    }
  }, 1200);
}

/* í˜ì´ì§€ ë¡œë“œ ì‹œ: ì˜¤ëŠ˜ ê²°ê³¼ ìˆìœ¼ë©´ ìë™ í‘œì‹œ */
window.onload = function () {
  if (TEST_MODE) return;

  const today = getToday();
  const savedDate = localStorage.getItem("drawDate");
  const savedResult = localStorage.getItem("drawResult");

  if (savedDate === today && savedResult) {
    showResult(JSON.parse(savedResult));
  }
};
</script>

</body>
</html>
