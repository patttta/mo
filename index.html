<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>퐁모코 쿠리빵</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
  text-align: center;
  padding: 60px;
}

.logo-wrap img {
  max-width: 350px;
  width: 100%;
  cursor: pointer;
  margin-bottom: 20px;
}

.title-image img {
  max-width: 280px;
  width: 100%;
  cursor: pointer;
}

/* 결과 영역 */
.result {
  display: none;
  margin-top: 30px;
}

.image-box {
  position: relative;
  height: 260px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.image-box img {
  max-height: 100%;
  border-radius: 12px;
}

/* 텍스트 */
.result-text {
  margin-top: 16px;
  font-size: 18px;
}

/* 두근두근 */
@keyframes heartbeat {
  0% { transform: scale(1); }
  50% { transform: scale(1.07); }
  100% { transform: scale(1); }
}
.waiting {
  animation: heartbeat 0.6s infinite;
  opacity: 0.75;
}

/* 팝 */
@keyframes pop {
  0% { opacity: 0; transform: scale(0.85); }
  60% { opacity: 1; transform: scale(1.05); }
  100% { transform: scale(1); }
}
.pop {
  animation: pop 0.35s ease-out;
}

/* ✨ 히든 샤랄라 */
.sparkle {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.9), transparent 40%),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.8), transparent 40%),
    radial-gradient(circle at 50% 80%, rgba(255,255,255,0.7), transparent 45%);
  animation: sparkleFade 1.2s ease-out forwards;
  pointer-events: none;
}

@keyframes sparkleFade {
  0% { opacity: 0; transform: scale(0.8); }
  40% { opacity: 1; }
  100% { opacity: 0; transform: scale(1.2); }
}

#dateInfo {
  margin: 20px 0;
  font-size: 14px;
  color: #8D7860;
}
</style>
</head>

<body>

<div class="logo-wrap">
  <img src="https://i.imgur.com/rYcxn0Z.png" onclick="location.reload()">
</div>

<div id="dateInfo">
  <div id="todayText"></div>
  <div id="countdownText"></div>
</div>

<div class="title-image" onclick="drawBeads()">
  <img id="drawImage" src="https://i.imgur.com/e9JGabn.png">
</div>

<div class="result" id="resultBox">
  <div class="image-box">
    <img id="resultImage">
    <div id="sparkleEffect"></div>
  </div>
  <div class="result-text" id="resultText"></div>
</div>

<script>
const TEST_MODE = true; // 테스트 끝나면 false

const items = [
  { img: "https://i.imgur.com/6ZgUNGp.png", text: "뚱뚱쿠리 등장!", weight: 40 },
  { img: "https://i.imgur.com/O8UUh0T.png", text: "열공쿠리 등장!", weight: 40 },
  { img: "https://i.imgur.com/aqYwzkm.png", text: "바보쿠리 등장!", weight: 40 },
  { img: "https://i.imgur.com/OBTpOLq.png", text: "✨ 시크릿 갸루쿠리 ✨", weight: 8 }
];

function weightedRandom(list) {
  const total = list.reduce((s, i) => s + i.weight, 0);
  let r = Math.random() * total;
  for (const item of list) {
    if ((r -= item.weight) < 0) return item;
  }
}

function drawBeads() {
  const drawImg = document.getElementById("drawImage");
  const box = document.getElementById("resultBox");
  const img = document.getElementById("resultImage");
  const text = document.getElementById("resultText");

  box.style.display = "block";
  drawImg.classList.add("waiting");

  setTimeout(() => {
    drawImg.classList.remove("waiting");

    const result = weightedRandom(items);
    img.src = result.img;
    text.innerText = result.text;

    img.classList.remove("pop");
    void img.offsetWidth;
    img.classList.add("pop");

    if (result === items[3]) {
      const s = document.getElementById("sparkleEffect");
      s.className = "sparkle";
      setTimeout(() => s.className = "", 1200);
    }
  }, 1200);
}

function updateDate() {
  const now = new Date();
  document.getElementById("todayText").innerText =
    `오늘 · ${now.getFullYear()}년 ${now.getMonth()+1}월 ${now.getDate()}일`;

  const midnight = new Date();
  midnight.setHours(24,0,0,0);
  const diff = midnight - now;
  const h = String(Math.floor(diff/3600000)).padStart(2,"0");
  const m = String(Math.floor(diff/60000)%60).padStart(2,"0");
  const s = String(Math.floor(diff/1000)%60).padStart(2,"0");

  document.getElementById("countdownText").innerText =
    `다음까지 · ${h}:${m}:${s}`;
}

updateDate();
setInterval(updateDate, 1000);
</script>

</body>
</html>
